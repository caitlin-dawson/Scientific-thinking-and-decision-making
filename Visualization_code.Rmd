---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

#Visualising data
```{r}
#Visualizing the data

# Need to organize the investigation! Some correlations are not straightforward, e.g. CMean is correlated with both ES and NFC, but ES and NFC are negatively correlated with each other! 
# Investigate!
# 
# It cannot only be about factoring and clustering. Those methods will get rid of variables that are singly related to another variable singly. We also want to pursue these single variables in relation to the extant literature and see if we replicate their results!
```

# visualising correlations

```{r}

#visualizing the correlations

library(ggplot2)
library(hrbrthemes)

p1 <- ggplot(data_all_sub_cleaned, aes(x = CloSum, y = IH3Sum)) +  
  geom_point(color = "#69b3a2")

p3 <- ggplot(data_all_sub_cleaned, aes(x = Sci.id_Sum, y = CloSum)) +  
  geom_point() +
  geom_smooth(method = lm, color = "red", fill = "#69b3a2", se = TRUE)
  
p3

rcorr(all_cor, type = c("spearman"))

library("Hmisc") 
res2 <- rcorr(as.matrix(all_cor))


```

# random packages for visualizations

```{r}
#circular packing
library(ggraph) 
library(igraph) 
library(tidyverse) 
library(viridis) 
library(data.tree)

#chord plot
library(circlize)
library(chorddiag)
library(Migest)

#polar/radar/spider plots
library(fmsb)

#this is scaled raw ppt data without GNG vars or binary vars, used for clustering by ppt
data <- Bclust
#have to add 2 rows at the top of the df to ID the min and max of each variable
#add the min
data <- rbind(c(0, -3.0924, -2.46150, -2.2422, -2.64471, -3.4793, -2.4621, -2.54740, -2.7792, -2.4046, -2.73994, -2.5634, -2.31735, -2.5716, -2.6758, -2.6963, -2.37277, -2.13110, -2.1096, -3.2408, -2.8489, -1.96163, -3.09380, -1.6906), data)

#add the max
data <- rbind(c(0, 1.9342, 1.84697, 1.8060, 1.95134, 1.5600, 1.3460, 2.50386, 1.6212, 1.6031, 1.83320, 2.6862, 2.41944, 1.9469, 1.6553, 1.5736, 1.82200, 2.07669, 1.2503, 1.3693, 1.4509, 2.52539, 3.41422, 2.8022), data)

#from clustering, take the cluster designation for each ppt as a column
hc.cut <- hcut(Bclust, k = 4, hc_method = "complete")
# Visualize dendrogram
#the dendrogram solutions are all pretty clear that there are 3 main clusters 
fviz_dend(hc.cut, show_labels = FALSE, rect = TRUE)
# Visualize cluster
fviz_cluster(hc.cut, ellipse.type = "convex")

colnames(datatest)[1] <- "Cluster"

#adding the previously identified cluster as a grouping variable for visualization
datatest <- cbind(hc.cut$cluster, data)

#set graphic colors
library(RColorBrewer)
coul <- brewer.pal(4, "BuPu")
colors_border  <-  coul
library(scales)
colors_in <- alpha(coul, 0.3)


           #,axistype=0,maxmin=F,pcol=colors_border,pfcol=colors_in,plwd=4,plty=1,cglcol="grey",cglty=1,axislabcol="black",cglwd=0.8,vlcex=0.8)

#this works but it's every ppt on top of each other
radarchart(data.frame(data), axistype = 0, maxmin = F, 
           pcol = colors_border, plwd = 4, plty = 1,
           cglcol = "grey", cglty = 1, axislabcol = "black", 
           cglwd = 0.8, vlcex = 0.8)

cluster1 <- data.frame(data) %>%
  filter(Cluster == "1")
cluster2 <- data.frame(data) %>%
  filter(Cluster == "2")
cluster3 <- data.frame(data) %>%
  filter(Cluster == "3")
cluster4 <- data.frame(data) %>%
  filter(Cluster == "4")

par(mfrow = c(2, 2))
c1 <- radarchart(data.frame(cluster1), axistype = 0, maxmin = FALSE, 
                 pty = 32, cglcol = "grey", pcol = "black", 
                 cglty = 1, axislabcol = "black")
c2 <- radarchart(data.frame(cluster2), axistype = 0, maxmin = FALSE, 
                 pty = 32, cglcol = "grey", pcol = "black", 
                 cglty = 1, axislabcol = "black")
c3 <- radarchart(data.frame(cluster3), axistype = 0, maxmin = FALSE, 
                 pty = 32, cglcol = "grey", pcol = "black", 
                 cglty = 1, axislabcol = "black")
c4 <- radarchart(data.frame(cluster4), axistype = 0, maxmin = FALSE, 
                 pty = 32, cglcol = "grey", pcol = "black", 
                 cglty = 1, axislabcol = "black")

grid.arrange(c1, c2, c3, c4, nrow = 2)

#parallel coordinates plot
#this only makes sense if you already know either how many clusters there are and add cluster identity through a categorical variable, or are interested in grouping via a categorical variable
#this might be interesting to visualize demographic differences across the variables of the whole dataset 
library(GGally)
library(hrbrthemes)

# Data set
#includes a grouping variable, "Cluster"
data <- datatest
data$Cluster <- as.factor(data$Cluster)

# Plot 
ggparcoord(data.frame(data), 
    columns = 2:24, 
    showPoints = TRUE, 
    title = "Parallel Coordinate Plot", 
    groupColumn = 1, 
    order = "allClass",
    alphaLines = 0.8 
    ) +  
  scale_color_viridis() + 
  theme_ipsum() + 
  theme( 
    plot.title = element_text(size = 10) 
  )

#ggparcoord(data, 
#    columns = 1:23, groupColumn = 5 
#    ) 


#circular barplots
# Make the plot 
p <- ggplot(data.frame(data), aes(x = as.factor(Cluster), y = value)) +       
  # Note that id is a factor. If x is numeric, there is some space between the first bar 
   
  # This add the bars with a blue color 
  geom_bar(stat = "Cluster", fill = alpha("blue", 0.3)) + 
   
  # Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar 
  ylim(-100, 120) + 
   
  # Custom the theme: no axis title and no cartesian grid 
  theme_minimal() + 
  theme( 
    axis.text = element_blank(), 
    axis.title = element_blank(), 
    panel.grid = element_blank(), 
    plot.margin = unit(rep(-2,4), "cm")     # This remove unnecessary margin around plot 
  ) + 
   
  # This makes the coordinate polar instead of cartesian. 
  coord_polar(start = 0) 
p



#compare clusters
library(IntClust)
#HeatmapPlot
library(devTools)
library(xml2) 
library(htmltools) 
library(knitr) 
library(kableExtra) 
library(ggplot2) 
library(data.table)
library(compareGroups)

#pareto
library(AdaptGauss)

#hierarchical edge bundling 
# ????





```


```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
